reset_state
table_set_default MyIngress.EnabledFuncsTable setEnabledFuncs 1 1
table_set_default ipv4_lpm drop
table_add ipv4_lpm ipv4_fwd 10.1.0.1/24 => 10.1.0.1 1
table_add ipv4_lpm ipv4_fwd 10.2.0.1/24 => 10.2.0.1 1
table_add ipv4_lpm ipv4_fwd 10.3.0.1/24 => 10.3.0.1 1
table_add ipv4_lpm ipv4_fwd 10.4.0.10/32 => 10.4.0.10 3
table_add ipv4_lpm ipv4_fwd 10.4.0.20/32 => 10.4.0.20 2
table_add ipv4_lpm ipv4_fwd 10.4.0.30/32 => 10.4.0.30 2
table_add ipv4_lpm ipv4_fwd 10.4.0.40/32 => 10.4.0.40 2

table_set_default src_mac drop
table_add src_mac rewrite_src_mac 1 => 00:00:00:01:04:01
table_add src_mac rewrite_src_mac 2 => 00:00:00:01:04:02
table_add src_mac rewrite_src_mac 3 => 00:00:00:01:04:03

table_set_default dst_mac drop
table_add dst_mac rewrite_dst_mac 10.1.0.1 => 00:00:00:01:01:04
table_add dst_mac rewrite_dst_mac 10.4.0.20 => 00:00:00:02:11:01
table_add dst_mac rewrite_dst_mac 10.4.0.30 => 00:00:00:02:12:01
table_add dst_mac rewrite_dst_mac 10.4.0.40 => 00:00:00:02:13:01
table_add dst_mac rewrite_dst_mac 10.4.0.10 => 00:00:00:02:10:01
table_add dst_mac rewrite_dst_mac 10.2.0.1 => 00:00:00:01:01:04
table_add dst_mac rewrite_dst_mac 10.3.0.1 => 00:00:00:01:01:04

table_add self_icmp reply_to_icmp 10.4.0.1 1
table_add MyIngress.checkPacketDirection setPacketDirection 10.4.0.0&&&255.255.255.0 10.0.0.0&&&0.0.0.0 => 1 1
table_add MyIngress.checkPacketDirection setPacketDirection  10.0.0.0&&&0.0.0.0 10.4.0.0&&&255.255.255.0 => 2 1
table_add MyIngress.checkPacketDirection setPacketDirection  10.0.0.0&&&0.0.0.0 10.0.0.0&&&0.0.0.0 => 3 1

table_add MyEgress.ServerLookup setCurrentServer 0 => 10.4.0.10 10.4.0.1 1
table_add MyEgress.ServerLookup setCurrentServer 1 => 10.4.0.10 10.4.0.1 2
table_add MyEgress.ServerLookup setCurrentServer 2 => 10.4.0.10 10.4.0.1 3
table_add MyEgress.ServerLookup setCurrentServer 3 => 10.4.0.10 10.4.0.1 4
table_add MyEgress.ServerLookup setCurrentServer 4 => 10.4.0.10 10.4.0.1 5
table_add MyEgress.ServerLookup setCurrentServer 5 => 10.4.0.20 10.4.0.1 6
table_add MyEgress.ServerLookup setCurrentServer 6 => 10.4.0.20 10.4.0.1 7
table_add MyEgress.ServerLookup setCurrentServer 7 => 10.4.0.30 10.4.0.1 8
table_add MyEgress.ServerLookup setCurrentServer 8 => 10.4.0.30 10.4.0.1 9
table_add MyEgress.ServerLookup setCurrentServer 9 => 10.4.0.30 10.4.0.1 10
table_add MyEgress.ServerLookup setCurrentServer 10 => 10.4.0.30 10.4.0.1 11
table_add MyEgress.ServerLookup setCurrentServer 11 => 10.4.0.30 10.4.0.1 12
table_add MyEgress.ServerLookup setCurrentServer 12 => 10.4.0.30 10.4.0.1 13
table_add MyEgress.ServerLookup setCurrentServer 13 => 10.4.0.30 10.4.0.1 14
table_add MyEgress.ServerLookup setCurrentServer 14 => 10.4.0.30 10.4.0.1 15
table_add MyEgress.ServerLookup setCurrentServer 15 => 10.4.0.40 10.4.0.1 0

table_set_default fwall drop
table_add fwall_rules RulesSuccess 10.1.0.0&&&255.255.255.0 10.4.0.1&&&255.255.255.255 0x06 80 => 85 1
table_add privateToPublicPort setPublicPort 85 => 80
